<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mon Coach Running</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: sans-serif; padding: 20px; max-width: 600px; margin: auto; }
        h1 { color: #2e8b57; }
        .section { margin: 20px 0; }
    </style>
</head>
<body>

<h1>üèÉ Mon Coach Running</h1>

<div class="section">
    <h2>Dernier run ({{ dashboard.date }})</h2>
    <p>
        üìè {{ dashboard.distance_km }} km en {{ dashboard.duration_min }} min 
        | allure {{ dashboard.allure }}/km
    </p>
    <p>
        ü´Ä FC moy: {{ dashboard.fc_moy }} | FC max: {{ dashboard.fc_max }} 
        | k: {{ dashboard.k_moy }} 
        | d√©rive: +{{ dashboard.deriv_cardio }}%
        | Œîalt: +{{ dashboard.gain_alt }} m
    </p>
</div>

{% if dashboard.events_recent %}
<div class="section">
    <h3>ü©π √âv√©nements r√©cents</h3>
    <ul>
        {% for e in dashboard.events_recent %}
        <li>il y a {{ e.days_ago }} jours : {{ e.note }}</li>
        {% endfor %}
    </ul>
</div>
{% endif %}

<div class="section">
    <h3>üìà FC, allure et k par lap</h3>
    <canvas id="chart"></canvas>
</div>

<script>
const laps = {{ dashboard.laps|tojson }};
const labels = laps.map(l => `Lap ${l.lap_number}`);
const fcData = laps.map(l => l.fc_avg ? l.fc_avg.toFixed(1) : null);
const paceData = laps.map(l => l.pace_velocity ? l.pace_velocity.toFixed(2) : null);
const kData = laps.map(l => (l.fc_avg && l.pace_velocity) ? (l.fc_avg / l.pace_velocity).toFixed(1) : null);

const ctx = document.getElementById('chart').getContext('2d');
new Chart(ctx, {
    type: 'line',
    data: {
        labels: labels,
        datasets: [
            {
                label: 'FC moy',
                data: fcData,
                borderColor: 'red',
                yAxisID: 'y1'
            },
            {
                label: 'Allure (pace)',
                data: paceData,
                borderColor: 'blue',
                yAxisID: 'y2'
            },
            {
                label: 'k (FC/Allure)',
                data: kData,
                borderColor: 'green',
                yAxisID: 'y3'
            }
        ]
    },
    options: {
        scales: {
            y1: { type: 'linear', position: 'left', title: { display: true, text: 'FC (bpm)' } },
            y2: { type: 'linear', position: 'right', title: { display: true, text: 'Allure min/km' } },
            y3: { type: 'linear', position: 'right', grid: { drawOnChartArea: false }, title: { display: true, text: 'k' } }
        }
    }
});
</script>

</body>
</html>
