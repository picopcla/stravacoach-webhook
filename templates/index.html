<canvas id="chartGlobal"></canvas>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const ctx = document.getElementById('chartGlobal').getContext('2d');
const chart = new Chart(ctx, {
  type: 'line',
  data: {
    labels: Array.from({length: {{ dashboard.points_fc|length }}}, (_, i) => i+1),
    datasets: [
      {
        label: 'Allure (min/km)',
        data: {{ dashboard.laps_pace_per_point }},
        borderColor: 'blue',
        yAxisID: 'y',
        fill: false,
        tension: 0.4,
        pointRadius: 0
      },
      {
        label: 'FC (bpm)',
        data: {{ dashboard.points_fc }},
        borderColor: 'red',
        yAxisID: 'y1',
        fill: false,
        tension: 0.4,
        pointRadius: 0
      },
      {
        label: 'Élévation',
        data: {{ dashboard.points_alt }},
        borderColor: (ctx) => {
          const gradient = ctx.chart.ctx.createLinearGradient(0, 0, ctx.chart.width, 0);
          gradient.addColorStop(0, 'green');
          gradient.addColorStop(1, 'red');
          return gradient;
        },
        yAxisID: 'y2',
        fill: true,
        tension: 0.3,
        pointRadius: 0
      }
    ]
  },
  options: {
    responsive: true,
    scales: {
      x: { type: 'linear', title: { display: true, text: 'Progression (points 10s)' }},
      y: { type: 'linear', position: 'left', title: { display: true, text: 'Allure (min/km)' }, min: 3.5 },
      y1: { type: 'linear', position: 'right', title: { display: true, text: 'FC (bpm)' }, grid: { drawOnChartArea: false }},
      y2: { type: 'linear', position: 'right', title: { display: true, text: 'Élévation (m)' }, grid: { drawOnChartArea: false }, offset: true }
    }
  }
});
</script>
